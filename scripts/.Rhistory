1+1
addinslist:::addinslistAddin()
library('MASS')
dat <- mvrnorm(n = 80, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
class(dat)
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.linpred
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
## Check
glm(Y ~ X1 + X2, data = dat, family = binomial) ## Should be close to -1.3, log(2), log(2).
## Check EPV
min(sum(dat$Y == 0), sum(dat$Y == 1)) / 2 ## Should be approximately 10.
install.packages("logistf")
glm(Y ~ X1 + X2, data = dat, family = binomial)
glm(Y ~ X1 + X2, data = dat, family = binomial)$parameter
glm(Y ~ X1 + X2, data = dat, family = binomial)$parameters
glm(Y ~ X1 + X2, data = dat, family = binomial)$beta
glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient
glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
logistif::logistif(Y ~ X1 + X2, data = dat)
logistf::logistf(Y ~ X1 + X2, data = dat)
x<- logistf::logistf(Y ~ X1 + X2, data = dat)
x$coefficients
x$coefficients[2]
glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
set.seed(1313)
method1 <- vector()
method2 <- vector()
datalist <- list()
for(i in 1:1000){
dat <- mvrnorm(n = 80, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
class(dat)
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
method1[i] <- logistf::logistf(Y ~ X1 + X2, data = dat)$coefficients[2]
method2[i] <- glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
datalist[i] <- dat
}
method1
method2
calcEPV<- function(dat){
min(sum(dat$Y == 0), sum(dat$Y == 1)) / 2
}
str(datalist)
lapply(X = datalist,FUN = calcEPV())
set.seed(1313)
method1 <- vector()
method2 <- vector()
datalist <- list()
for(i in 1:1000){
dat <- mvrnorm(n = 80, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
class(dat)
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
method1[i] <- logistf::logistf(Y ~ X1 + X2, data = dat)$coefficients[2]
method2[i] <- glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
datalist[[i]] <- dat
}
datalist
lapply(X = datalist,FUN = calcEPV())
lapply(X = datalist,FUN = calcEPV
)
?lapply
sapply(X = datalist,FUN = calcEPV)
simEPVs<- sapply(X = datalist,FUN = calcEPV)
simEPVs
mean(simEPVs-10)
simfunc1<- function(sampsize){
for(i in 1:1000){
dat <- mvrnorm(n = sampsize, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
method1 <- list()
method2 <- list()
datalist <- list()
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
method1[i] <- logistf::logistf(Y ~ X1 + X2, data = dat)$coefficients
method2[i] <- glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient
datalist[[i]] <- dat
}
simEPVs<- sapply(X = datalist,FUN = calcEPV)
return(mean(simEPVs-10))
}
simfunc1(80)
simfunc1(160)
simfunc1(320)
for(i 1 :1000){
cat(i, " \r"); flush.console()
}
for(i in  1 :1000){
cat(i, " \r"); flush.console()
}
# missing days with padr
library(dplyr)
library(padr)
library(ggplot2)
library(tibbletime)
# read data
all<-readRDS("../../data/peter/myLocationHistory.rds")
attr(all$time, "tzone") <- "Europe/Paris"
# by hour
mHour<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('hour') %>%
group_by(time_hour) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0) %>%
thicken("day") %>%
mutate(
type = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)) %>%
group_by(time_hour_day) %>%
summarise(hoursMissing = sum(type),
measurements = sum(measurements))
# read data
all<-readRDS("../../data/peter/myLocationHistory.rds")
setwd("C:/Users/Boaz Sobrado/Desktop/boaz/Life/Academic/Utrecht/year2/thesisFiles/thesis/scripts")
# read data
all<-readRDS("../../data/peter/myLocationHistory.rds")
attr(all$time, "tzone") <- "Europe/Paris"
m5min<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)
m5min
?dttm
strptime(m5min$time_5min,format = "HH:MM")
strptime(m5min$time_5_min,format = "HH:MM")
strftime(m5min$time_5_min,format = "HH:MM")
?strftime()
str(m5min)
strftime(m5min$time_5_min,format = "%H:%M")
# by 5 minute version 2
m5min<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0) %>%
m5min %>% mutate(hour = strftime(time_5_min,format = "%H:%M"))
m5min %>% mutate(hour = strftime(time_5_min,format = "%H:%M"))
# by 5 minute version 2
m5min<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0) %>%
m5min %>% mutate(hour = strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))
m5min %>% mutate(hour = strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))
m5min %>% mutate(hour = as.POSIXct(strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest")))
head(m5min$time_5_min)
x<- head(m5min$time_5_min)
strftime(x,format = "%H:%M", tz = "Europe/Budapest")
paste0("2014-01-22 ",strftime(x,format = "%H:%M", tz = "Europe/Budapest"))
as.POSIXct(paste0("2014-01-22 ",strftime(x,format = "%H:%M", tz = "Europe/Budapest")))
m5min<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))))
m5min
tail(m5min)
ggplot(m5min, aes(x = hour, y=measurements))+
geom_point()+theme_tufte()
library(ggthemes)
ggplot(m5min, aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")
m5minv2 %>% time_filter(2017 ~)
m5minv2 %>% time_filter(2017 ~ 2017)
m5minv %>% time_filter(2017 ~ 2017)
m5min %>% time_filter(2017 ~ 2017)
m5minv2<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2017-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))))
ggplot(m5minv2, aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2
hist(m5minv2$measurements)
m5minv2<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))))
hist(m5minv2)
hist(m5minv2$measurements)
m5minv2 %>% time_filter(2017 ~ 2017) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time)%>%
time_filter(2017 ~ 2017) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time)
m5minv2
m5minv2 %>%
as_tbl_time(index = time_5_min)%>%
time_filter(2017 ~ 2017) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time_5_min)%>%
time_filter(2017-01-15 ~ 2017-01-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time_5_min)%>%
time_filter(2017-01-15 ~ 2017-01-15)
m5minv2<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(
hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))),
time2 = lubridate::force_tz(time_5_min, "Asia/Singapore"),
missing = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)
)
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-01-15 ~ 2017-01-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-01-15 ~ 2017-01-15)
View(m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-01-15 ~ 2017-01-15))
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-02-15 ~ 2017-02-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-02-15 ~ 2017-02-15)
m5minv2
max(m5minv5$time2)
max(m5minv2$time2)
# read data
all<-readRDS("../../data/boaz/myLocationHistory.rds")
attr(all$time, "tzone") <- "Europe/Paris"
# by 5 minute version 2
m5minv2<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(
hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))),
time2 = lubridate::force_tz(time_5_min, "Asia/Singapore"),
missing = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)
)
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-02-15 ~ 2017-02-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-01-01 ~ 2017-02-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2016-01-01 ~ 2017-02-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-02-15 ~ 2017-02-15) %>%
ggplot( aes(x = hour, y=measurements))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
m5minv2 %>%
as_tbl_time(index = time2)%>%
time_filter(2017-02-15 ~ 2017-02-15) %>%
ggplot( aes(x = hour, y=measurements, colour = missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")
?case_when()
m5minv2<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
mutate(acc2 = case_when(
accuracy <20 ~ "accurate",
accuracy >20 & accuracy <250 ~ "moderately accurate",
accuracy >250 ~ "moderately accurate"))%>%
group_by(time_5_min, acc2) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(
hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))),
time2 = lubridate::force_tz(time_5_min, "Asia/Singapore"),
missing = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)
)
m5minv2<- all %>%
select(time,accuracy) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
mutate(acc2 = case_when(
accuracy <20 ~ "accurate",
accuracy >20 & accuracy <250 ~ "moderately accurate",
accuracy >250 ~ "moderately accurate"))%>%
group_by(time_5_min, acc2) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(
hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))),
time2 = lubridate::force_tz(time_5_min, "Asia/Singapore"),
missing = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)
)
m5minv2
m5minv2<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0)%>%
mutate(
hour = as.POSIXct(
paste0("2014-01-22 ",
strftime(time_5_min,format = "%H:%M", tz = "Europe/Budapest"))),
time2 = lubridate::force_tz(time_5_min, "Asia/Singapore"),
missing = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)
)
m5minv2
