1+1
addinslist:::addinslistAddin()
library('MASS')
dat <- mvrnorm(n = 80, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
class(dat)
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.linpred
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
## Check
glm(Y ~ X1 + X2, data = dat, family = binomial) ## Should be close to -1.3, log(2), log(2).
## Check EPV
min(sum(dat$Y == 0), sum(dat$Y == 1)) / 2 ## Should be approximately 10.
install.packages("logistf")
glm(Y ~ X1 + X2, data = dat, family = binomial)
glm(Y ~ X1 + X2, data = dat, family = binomial)$parameter
glm(Y ~ X1 + X2, data = dat, family = binomial)$parameters
glm(Y ~ X1 + X2, data = dat, family = binomial)$beta
glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient
glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
logistif::logistif(Y ~ X1 + X2, data = dat)
logistf::logistf(Y ~ X1 + X2, data = dat)
x<- logistf::logistf(Y ~ X1 + X2, data = dat)
x$coefficients
x$coefficients[2]
glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
set.seed(1313)
method1 <- vector()
method2 <- vector()
datalist <- list()
for(i in 1:1000){
dat <- mvrnorm(n = 80, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
class(dat)
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
method1[i] <- logistf::logistf(Y ~ X1 + X2, data = dat)$coefficients[2]
method2[i] <- glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
datalist[i] <- dat
}
method1
method2
calcEPV<- function(dat){
min(sum(dat$Y == 0), sum(dat$Y == 1)) / 2
}
str(datalist)
lapply(X = datalist,FUN = calcEPV())
set.seed(1313)
method1 <- vector()
method2 <- vector()
datalist <- list()
for(i in 1:1000){
dat <- mvrnorm(n = 80, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
class(dat)
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
method1[i] <- logistf::logistf(Y ~ X1 + X2, data = dat)$coefficients[2]
method2[i] <- glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient[2]
datalist[[i]] <- dat
}
datalist
lapply(X = datalist,FUN = calcEPV())
lapply(X = datalist,FUN = calcEPV
)
?lapply
sapply(X = datalist,FUN = calcEPV)
simEPVs<- sapply(X = datalist,FUN = calcEPV)
simEPVs
mean(simEPVs-10)
simfunc1<- function(sampsize){
for(i in 1:1000){
dat <- mvrnorm(n = sampsize, mu = c(0, 0), Sigma = matrix(c(1, 0.2, 0.2, 1), nrow = 2))
dat <- as.data.frame(dat)
colnames(dat) <- c('X1', 'X2')
method1 <- list()
method2 <- list()
datalist <- list()
## Simulate Y
Y.linpred <- -1.3 + log(2) * dat$X1 + log(2) * dat$X2
Y.prob <- exp(Y.linpred) / (1 + exp(Y.linpred))
dat$Y <- rbinom(n = nrow(dat), size = 1, prob = Y.prob)
method1[i] <- logistf::logistf(Y ~ X1 + X2, data = dat)$coefficients
method2[i] <- glm(Y ~ X1 + X2, data = dat, family = binomial)$coefficient
datalist[[i]] <- dat
}
simEPVs<- sapply(X = datalist,FUN = calcEPV)
return(mean(simEPVs-10))
}
simfunc1(80)
simfunc1(160)
simfunc1(320)
for(i 1 :1000){
cat(i, " \r"); flush.console()
}
for(i in  1 :1000){
cat(i, " \r"); flush.console()
}
library(dplyr)
library(padr)
library(ggplot2)
library(tibbletime)
# read data
all<-readRDS("../data/peter/myLocationHistory.rds")
setwd("C:/Users/Boaz Sobrado/Desktop/boaz/Life/Academic/Utrecht/year2/thesisFiles/thesis/scripts")
# read data
all<-readRDS("../data/peter/myLocationHistory.rds")
getwd()
# read data
all<-readRDS("../../data/peter/myLocationHistory.rds")
attr(all$time, "tzone") <- "Europe/Paris"
attr(all$time, "tzone")
?thicken
?seq.Date
?seq.POSIXt
coffee
coffee
coffee %>%
thicken('day') %>%
group_by(time_stamp_day) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_day, day_amount)) + geom_line()
coffee %>%
thicken('minute') %>%
group_by(time_stamp_day) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_day, day_amount)) + geom_line()
coffee %>%
thicken(5) %>%
group_by(time_stamp_day) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_day, day_amount)) + geom_line()
coffee %>%
thicken(5) %>%
group_by(time_stamp_day) %>%
summarise(day_amount = sum(amount))
coffee %>%
thicken("minute") %>%
group_by(time_stamp_day) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_day, day_amount)) + geom_line()
coffee %>%
thicken("minute")
coffee %>%
thicken("min") %>%
group_by(time_stamp_day) %>%
summarise(day_amount = sum(amount)) %>%
pad()
coffee
coffee %>%
thicken("minutes")
coffee %>%
thicken("minute")
get_interval(coffee)
coffee2 <- coffee %>% thicken('day')
coffee2$time_stamp %>% get_interval
coffee %>%
thicken("minute")
coffee2$time_stamp %>% get_interval
coffee %>%
thicken("min")
coffee %>%
thicken("min") %>%
group_by(time_stamp_min) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_day, day_amount)) + geom_line()
coffee %>%
thicken("min") %>%
group_by(time_stamp_min) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_min, day_amount)) + geom_line()
coffee %>%
thicken("5 min") %>%
group_by(time_stamp_min) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_min, day_amount)) + geom_line()
coffee %>%
thicken("5 min")
coffee %>%
thicken("5 min") %>%
group_by(time_stamp_5min) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_5min, day_amount)) + geom_line()
coffee %>%
thicken("5 min") %>%
group_by(time_stamp__5min) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_5_min, day_amount)) + geom_line()
coffee %>%
thicken("5 min") %>%
group_by(time_stamp_5_min) %>%
summarise(day_amount = sum(amount)) %>%
pad() %>%
fill_by_value(day_amount) %>%
ggplot(aes(time_stamp_5_min, day_amount)) + geom_line()
m5min<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0) %>%
thicken("day") %>%
mutate(
type = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)) %>%
group_by(time_hour_day) %>%
summarise(hoursMissing = sum(type),
measurements = sum(measurements))
m5min<- all %>%
select(time) %>%
as_tbl_time(index = time) %>%
time_filter(2000-01 ~ 2017-06) %>%
thicken('5 min') %>%
group_by(time_5_min) %>%
summarise(measurements = n()) %>%
pad() %>%
fill_by_value(value = 0) %>%
thicken("day") %>%
mutate(
type = case_when(
measurements== 0 ~ 1,
measurements > 0 ~ 0)) %>%
group_by(time_5_min_day) %>%
summarise(hoursMissing = sum(type),
measurements = sum(measurements))
m5min
12*24
colnames(m5min)[2] <- "min5Missing"
m5min
288/2
missingDay5min<- ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing 5 minute segments")
library(ggthemes)
missingDay5min<- ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing 5 minute segments")
library(scales)
missingDay5min<- ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing 5 minute segments")
missingDay5min
ggsave(missingDay5min,filename = "img/missingdayPeter5min.png",device = "png",height = 6.5, units = "cm")
ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing \n 5 minute \n segments")
getwd()
missingDay5min<- ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing \n 5 minute \n segments")
ggsave(missingDay5min,filename = "../img/missingdayPeter5min.png",device = "png",height = 6.5, units = "cm")
m5min
m5min$time_5_min_day %>% summary()
m5min$min5Missing %>% summary()
colourpicker:::plotHelperAddin()
ggThemeAssist:::ggThemeAssistAddin()
ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing 5 minute segments")+
theme(legend.position = c(0.5, 0.85), legend.direction = "horizontal")
missingDay5min<- ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing 5 minute segments")+
theme(legend.position = c(0.5, 0.85), legend.direction = "horizontal")
ggsave(missingDay5min,filename = "../img/missingdayPeter5min.png",device = "png",height = 6.5, units = "cm")
ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing 5 minute segments")+
theme(legend.position = c(0.2, 0.85), legend.direction = "horizontal")
ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing \n5 minute\n segments")+
theme(legend.position = c(0.2, 0.85), legend.direction = "horizontal")
ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Amount of daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing \n5 minute\n segments")+
theme(legend.position = c(0.3, 0.85), legend.direction = "horizontal")
missingDay5min<- ggplot(m5min, aes(x = time_5_min_day, y=measurements, colour= min5Missing))+
geom_point()+theme_tufte()+
xlab("")+
ylab("Measurements")+
ggtitle("Missingness in daily measurements over time")+
scale_colour_gradient2(low = muted("green"), mid = "grey50",
high = muted("red"), midpoint = 144, space = "Lab",
na.value = "grey50", guide = "colourbar")+
labs(x = NULL, colour = "Missing \n5 minute\n segments")+
theme(legend.position = c(0.3, 0.85), legend.direction = "horizontal")
ggsave(missingDay5min,filename = "../img/missingdayPeter5min.png",device = "png",height = 6.5, units = "cm")
