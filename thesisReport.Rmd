---
title: 'Research Report: Longitudinal models of human mobility'
author: "Boaz Sobrado"
date: "`r format(Sys.time(), '%d %B %Y')`"
bibliography:
  - thesisGPS.bib
  - rReferences.bib
output:
  rmarkdown::pdf_document:
    fig_caption: yes        
    includes:  
      in_header: tp2.tex

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggthemes)
library(ggplot2)
```

# Introduction

How active people are and how they interact with their environment affects a wide range of measures including health , income and social capital [@goodchild_toward_2010]. A better understanding of both within-person and between-person variability in geospatial patterns could be conducive to better social, health and urban-planning policies. Yet a large part of studies on human mobility are largely based on pen-and-paper travel diaries. These surveys have known methodological flaws, such as the short period of data collection (due to costs and burden to respondents), the underreporting of short trips [@wolf_impact_2003] and the underestimation of the duration of commutes [@delclos-alio_keeping_2017].

Longitudinal data on human temporospatial behaviour has become available through smartphones and other sensors. This data has been used to investigate topics such as the effects of the food environment on eating patterns *Zenk*, the movement correlates of personality and academic performance [@harari_using_2016; @wang_smartgpa:_2015] and detecting bipolar disorder [@palmius_detecting_2017]. While there have been advances in processing this data [@zheng_mining_2009] extracting meaningful information remains a difficult task. Two important challenges are dealing with measurement noise and missing data.

With regards to measurement accuracy, studies of professional grade GPS trackers suggest that less than 80% of measurements fall within 10 meters of the true location. Moreover, GPS measures are reported to be most inaccurate in high density urban locations and indoors [@schipperijn_dynamic_2014;@duncan_portable_2013]. Unfortunately for researchers, this happens to be where most people in the developed world tend to spend most of their time. In addition, location data collected by more ubiquitous (but less specialised) smartphones are an amalgamation of sensor data. For instance, Android phones collect location information from WiFi access points, cellphone triangluation, and GPS measurements due to computational and battery constraints [@lamarca_place_2005;@chen_practical_2006]. This adds another layer of complexity as each of these measures has its own characteristics in terms of measurement accuracy and bias.

As for missing data it is a pervasive issue as it can arise due to multiple factors, both technical and behavioural. Technical reasons include signal loss, battery failure and device failure. Behavioural reasons include leaving the phone at home, switching the phone off, switching location tracking off, etc. As a result, applied researchers are often left with wide temporal gaps with no measurements. For instance, different groups studying the effect of bipolar disorder on human movement have reported missing data rates between 30% to 50% [@saeb_mobile_2015;@grunerbl_smartphone-based_2015;@palmius_detecting_2017]. Similar trends are consistently reported in other fields [e.g. @harari_using_2016;@jankowska_framework_2015].

There is currently no golden standard in how to deal with missing temporospatial data [@barnett_inferring_2016]. @jankowska_framework_2015 have pointed out that there is often little transparency regarding decisions of how to deal with it. Methods frequently used by researchers to reduce noise, such as throwing out inaccurate measurements [e.g. @palmius_detecting_2017] can increase the severity of the missing data problem. On the other hand, noisy data can lead to inaccurate conclusions if it is not accounted for.

In this paper we will compare methods used to deal with measurement error and missing data in location. Specifically, we are interested in location tracks as measured by commerically available smartphones. 

## State of the art

Research with respect to the analysis of GPS data is wideranging, highly interdisciplinary and often serves different purposes. The following section briefly illustrates the different methods used to solve the measurement inaccuracy and missing data problem.

### State Space Models

There is a vast literature of using state space models (SSMs) to improve measurements accuracy and deal with missing data. Behavioural ecologists for instance, have used SSMs to explain how animals interact with their environment [@patterson_statespace_2008]. These models can be quite complex, for example *Priesler* uses Markovian movement processes to characterise the effect of roads, food patches and streams on cyclical elk movements. The most well studied SSM is the Kalman filter, which is the optimal algorithm for inferring linear Gaussian systems. *Gurram* *Kalman* *Chen* *Brown*. The extended Kalman filter is the de facto standard for GPS measurements. 

The advantage of state space models is that they are flexible, deal with measurement inaccuracy, include information from different sources and can be used in real time. For our pourposes the main limitation is that these models are based on the Markov property. Thus, the estimated location at timepoint $k$ is often based only upon measurements at $k$ and the previous timepoint $k-1$. This assumption ignores the periodic nature of human movement, whereby people generally spend the nights at home and the day at work. Hierarchical structuring and conditioning on a larger context have been suggested as ways to improve their performance, but these are often computationally intractable or infeasible [@sadilek_far_2016].

### Spatiotemporal Imputation Methods

For highly correlated in time.


### Alternative models

Alternatives to state space models include long range-persistence models, such as cascading walks models  and the FarOut model which rely on self-similarity and autoregressive characteristics [@han_cascading_2015; @sadilek_far_2016]. The latter uses Fourier analysis and PCA to extract cyclical patterns in an individual's behaviour and reduce the dimensionality of the extracted features and yields interpretable predictions for an individuals location months in advance. 

## Methods

*An asside as to my conversation with Peter on 07.11*

We can get some trackers on people to measure movement constantly and be a "golden standard" to evaluate the models.

For December, it would be nice to have the Lit Rev section, plus an exploration of the problem. 

### Data & Analyses

The data used was collected between 2014 and 2017 on different Android devices. A total of X individuals contributed to the analysis, yielding a total of Y data points. Moreover we used diary information from **SOMEWHERE**.

Analyses were performed using R and a multitude of other packages (@ggplot2 @dplyr @leaflet @sp @ggthemes @base @sp1 @sp2).

*Plots: data points over time*

![Raw GPS measurements of a journey from de Uithof to Tuinwijk on February 17th 2017. The measurements are in red, the filtered path is in blue. The circles denote 67% confidence intervals of the given GPS measurement. Measurements and fitted points which follow each other in time are connected by lines. The inacurate measurements lead to estimates of irregular movements. The filtered movement estimate seems more accurate in terms of the path, but lags behind the unfiltered movement.](//img//Map1.png)


#### Filtering

*Carlson et al 2015* describe a personal activity measurement system (PALMS), which can filter data points (among others). Their system is validated using cameras.

Like others (e.g. @palmius_detecting_2017) they detect invalid points using extreme speed.

*Google* offers an out of the box activity inferral mechanism.

### Discussion on missing data

Our missing data patterns fit the broader pattern of missing data reported by others [@palmius_detecting_2017;@saeb_mobile_2015; @grunerbl_smartphone-based_2015;@harari_using_2016]. 

Missing data can  Importantly, one cannot say that the data is missing at random as there are a myriad of reasons why missingness can be related to location, such as turning off the phone on the plane before a long flight.

```{r missingDataPlot,echo = FALSE,fig.cap="Missing data over time for the author. The x-axis denotes time, the y-axis shows how many measurements are made on each day. The fill of the points shows the amount of hours of captured data each day.",fig.height=5}

ps<- readRDS("..//data//missingDataAnalysisBoaz.rds")

pal<- c("#4228A8", "#0D0101","#E04AC2")

ggplot(ps, aes(x = Day, y=count, fill = type, colour= type))+geom_point()+
  theme_tufte()+
  xlab("")+
  ylab("Measurements")+
  ggtitle("Missing data over time")+
  scale_colour_manual(values=pal)+
  theme(legend.position = c(0.8, 0.8))+
  theme(legend.title=element_blank())

rm(ps)
```

### Models

#### Spatiotemporal imputation methods


## Results

## Discussion

## References